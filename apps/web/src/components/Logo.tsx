'use client'

import { useEffect, useState } from 'react'
import { cn } from '@/lib/utils'

interface LogoProps {
  className?: string
  darkMode?: boolean // Manual override for dark mode
  width?: number
  height?: number
}

export function Logo({ 
  className, 
  darkMode: manualDarkMode, 
  width = 140, 
  height = 40 
}: LogoProps) {
  const [isDark, setIsDark] = useState(false)
  const [isMounted, setIsMounted] = useState(false)

  // Handle client-side rendering only
  useEffect(() => {
    setIsMounted(true)
  }, [])

  useEffect(() => {
    // Skip effect if not mounted (server-side rendering)
    if (!isMounted) return;

    // If dark mode is manually specified, use that value
    if (manualDarkMode !== undefined) {
      setIsDark(manualDarkMode)
      return
    }

    // Check for dark mode based on HTML class
    try {
      const isCurrentlyDark = document.documentElement.classList.contains('dark')
      setIsDark(isCurrentlyDark)

      // Listen for theme changes
      const observer = new MutationObserver((mutations) => {
        for (const mutation of mutations) {
          if (
            mutation.type === 'attributes' &&
            mutation.attributeName === 'class'
          ) {
            const isDarkNow = document.documentElement.classList.contains('dark')
            setIsDark(isDarkNow)
            break
          }
        }
      })

      // Only observe if document element exists
      if (document && document.documentElement) {
        observer.observe(document.documentElement, { attributes: true })
      }

      return () => {
        observer.disconnect()
      }
    } catch (error) {
      console.error('Error in Logo theme detection:', error)
      return () => {}
    }
  }, [manualDarkMode, isMounted])

  // Use a default color for server-side rendering
  const textColor = !isMounted ? "#000000" : (isDark ? "#FFFFFF" : "#000000")

  return (
    <div className={cn('flex items-center', className)}>
      <svg 
        width={width} 
        height={height} 
        viewBox="0 0 195 48" 
        fill="none" 
        xmlns="http://www.w3.org/2000/svg"
        className="transition-colors duration-200"
      >
        {/* Logo mark - stays green in both themes */}
        <path 
          fillRule="evenodd" 
          clipRule="evenodd" 
          d="M11.1236 34.736C6.7003 33.311 3.5 29.1612 3.5 24.2639C3.5 18.1888 8.42487 13.2639 14.5 13.2639C20.5751 13.2639 25.5 18.1888 25.5 24.2639C25.5 29.1613 22.2996 33.3111 17.8761 34.7361V23.3767C17.8762 23.3706 17.8762 23.3645 17.8762 23.3584C17.8762 21.8736 16.3646 20.6699 14.4999 20.6699C12.6353 20.6699 11.1237 21.8736 11.1237 23.3584L11.1236 23.3584V34.736Z" 
          fill="#02C18B"
        />
        {/* Text - changes color based on theme */}
        <path 
          d="M42.752 28.7568C42.752 30.9128 42.948 32.4808 44.3592 32.8336V33.5H36.284V32.8336C37.7736 32.4024 37.852 30.756 37.852 28.7568V8.9216C37.852 7.5496 37.46 6.9616 35.892 6.3736V5.7072L42.752 4.2568V28.7568ZM53.2184 30.8736C54.512 32.6768 56.276 32.7944 56.9424 32.8336V33.5H51.4152C48.7104 33.5 48.3576 32.7944 45.7312 28.8744C44.5552 27.1496 43.536 25.5816 43.536 25.5816L47.2208 21.5832C47.2208 21.5832 52.8264 15.8992 47.7304 16.056V15.3896H57.256V16.056C56.5504 16.1344 52.552 16.252 47.3384 22.6808C53.14 30.8736 53.2184 30.8736 53.2184 30.8736ZM62.2953 23.4256H69.9785C69.9785 18.4864 68.3713 15.7032 66.2153 15.7032C63.9025 15.7032 62.2953 19.6624 62.2953 23.4256ZM66.4113 15.0368C72.0953 15.0368 74.7609 17.9768 74.7609 24.092H62.2953C62.6089 27.9336 64.5689 29.9328 67.1953 30.5208C69.3121 30.9912 72.4481 30.2072 73.4281 28.3648L74.0945 28.7176C73.4673 30.756 71.1545 33.8528 65.9017 33.8528C60.7665 33.8528 57.2385 29.1096 57.2385 24.5232C57.2385 18.996 61.0017 15.0368 66.4113 15.0368ZM88.3633 15.3896H96.0465V16.056C95.2233 16.056 93.4201 16.1344 90.9113 22.1712L84.9137 37.9688C83.8945 40.6344 82.7185 41.732 81.9737 42.32C81.2681 42.908 79.8961 43.1432 78.9553 42.712C77.5833 42.0848 76.9953 40.4776 77.5833 39.1056C78.2105 37.7336 79.8177 37.1064 81.1897 37.7336C81.8953 38.0472 82.3265 38.6744 82.5225 39.3408C82.6793 39.8112 83.6201 39.5368 84.2473 37.8904L85.7369 33.8528C83.3065 28.2472 78.3281 17.5848 78.3281 17.5848C77.7009 16.056 76.4465 16.056 75.8585 16.056V15.3896H85.1097V16.056C83.0713 16.056 84.0905 18.4472 84.0905 18.4472L88.2457 27.3064L90.3233 22.0144C90.3233 22.0144 92.9105 16.0168 88.3633 16.056V15.3896ZM108.513 23.3472C112.002 25.5032 113.178 28.9136 111.218 31.736C111.218 31.736 109.728 33.8528 105.73 33.8528C100.986 33.8528 98.6344 32.0496 98.6344 32.0496V27.1104H99.3008C99.8888 28.6392 101.143 33.1864 105.73 33.1864C108.513 33.1864 108.983 29.6584 106.004 27.6984L102.045 25.3072C98.2424 22.9944 97.2232 19.8192 99.3792 16.9968C99.3792 16.9968 100.869 15.0368 104.789 15.0368C109.297 15.0368 111.257 16.2128 111.257 16.2128V20.6032H110.59C110.081 19.2312 108.826 15.7032 104.789 15.7032C102.241 15.7032 101.143 18.7216 104.554 20.8776L108.513 23.3472ZM124.598 31.0696C125.735 31.0696 126.597 30.2856 126.95 29.6976L127.538 30.0504C126.754 31.8928 124.363 33.8528 121.736 33.8528C118.64 33.8528 116.797 32.5984 116.797 27.8552V16.056H114.837L114.72 15.3896H116.797V10.1368L121.697 9.3136V15.3896H126.362L126.205 16.056H121.697V27.7376C121.697 29.9328 122.638 31.0696 124.598 31.0696ZM138.848 15.0368C144.845 15.0368 148.177 19.2704 148.177 24.4448C148.177 29.58 144.845 33.8528 138.848 33.8528C132.889 33.8528 129.518 29.58 129.518 24.4448C129.518 19.2704 132.889 15.0368 138.848 15.0368ZM138.848 33.1864C141.67 33.1864 142.376 31.54 142.376 24.4448C142.376 17.3496 141.67 15.7032 138.848 15.7032C136.025 15.7032 135.281 17.3496 135.281 24.4448C135.281 31.54 136.025 33.1864 138.848 33.1864ZM168.352 28.7176C168.352 30.8736 168.548 32.4808 169.959 32.8336V33.5H161.884V32.8336C163.374 32.4024 163.452 30.7168 163.452 28.7176V21.1128C163.452 19.2312 162.237 17.8592 160.277 17.8592C158.748 17.8592 156.945 19.5056 156.945 21.0736V28.796C156.945 30.952 157.18 32.4416 158.552 32.8336V33.5H150.516V32.8336C152.006 32.4024 152.045 30.7952 152.045 28.796V19.9368C152.045 18.5648 151.692 18.1336 150.085 17.2712V16.6048L156.945 15.0368V19.2312C157.847 16.84 160.943 15.0368 163.413 15.0368C166.471 15.0368 168.352 16.252 168.352 20.9952V28.7176ZM177.292 23.4256H184.975C184.975 18.4864 183.368 15.7032 181.212 15.7032C178.899 15.7032 177.292 19.6624 177.292 23.4256ZM181.408 15.0368C187.092 15.0368 189.758 17.9768 189.758 24.092H177.292C177.606 27.9336 179.566 29.9328 182.192 30.5208C184.309 30.9912 187.445 30.2072 188.425 28.3648L189.091 28.7176C188.464 30.756 186.151 33.8528 180.899 33.8528C175.763 33.8528 172.235 29.1096 172.235 24.5232C172.235 18.996 175.999 15.0368 181.408 15.0368Z" 
          fill={textColor}
          className="transition-colors duration-200"
        />
      </svg>
    </div>
  )
} 